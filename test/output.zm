

// Single line of output for the familiarization/habituation phase.

enum exp_phase {
    PHASE_HAB,
    PHASE_TEST
};

record TestOutput
{
    exp_phase phase;    // the phase of the experiment
    int     trialnum;   // 
    int     lt;         // looking time(ms)
    int     nlt;        // time spend not looking.
    int     lookaways;  // number of time a child looked away.
}

TestOutput[..] hab_output;
TestOutput[..] test_output;


void hab_output_append(TestOutput output)
{
    hab_output.size = hab_output.size + 1;
    hab_output[hab_output.size-1] = output;
}

// test
bool habituation_done()
{
    if (hab_output.size < 6)
        return false;

    real mean_first3 = hab_output[0].lt + hab_output[1].lt + hab_output[2].lt;
    mean_first3 = mean_first3 / 3;

    real mean_last3 = (hab_output[hab_output.size - 3].lt +
                      hab_output[hab_output.size - 2].lt +
                      hab_output[hab_output.size - 1].lt)    /3;
    mean_last3 = mean_last3 / 3;
    
    return mean_first3 * 0.65 > mean_last3;
}

void test_output_append(TestOutput output)
{
    test_output.size = hab_output.size + 1;
    test_output[hab_output.size-1] = output;
}
